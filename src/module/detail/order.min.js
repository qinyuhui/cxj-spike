$(document).ready(function(){


    var orderCode=$.getQueryString('orderid');


    //document.cookie = "sc_s=" + "MDEyMzU4NWI4MWU0NTg4MzBlZTQ5MzYwMTDv1sZBFYbSAgQEyKBQecF-G8bS8g";
    var url = '/prmtcenter/orderDetail/info.htm';
    var url1=location.href;
    var urlDomain='chexiang';
    if(url1.indexOf('sit')!=-1){
      urlDomain='chexiangsit';
    }else if(url1.indexOf('chexiangpre')!=-1){
      urlDomain='chexiangpre';
    }

    
    var data = {
        'orderCode':orderCode
    };
    $.postajax(url, data, function(res){
        console.log(res);
        // 登录成功
        if(res.isSuccess){

            var resData = res.data;
            //如果有数据说明订单编号是对的
            if(resData.orderInfo){
                var orderInfo=resData.orderInfo;
                var payFont="";
                var orderNum=orderInfo.orderCode;
                var tk=''; // 退款
                var orderStatus=orderInfo.status; //订单状态
                if(orderInfo.logisticsInfo){
                    var ps=true; //配送
                    var d=orderInfo.logisticsInfo;
                    var address=d.provinceDescription+d.cityDescription+d.areaDescription+d.receiverAddress;
                    var mode="全国包邮";
                    var name=d.receiverName;
                    var phone=orderInfo.mobile;
                    var deliver=d.distributionStatus;  //发货状态
                    tk=resData.executionStatus?resData.executionStatus:'';
                }else{
                    var ps=false;
                    $(".give").hide();
                }
                
                

                switch(orderStatus)
                {
                  case 1:
                    payFont="待支付";
                    break;
                  case 3:
                    payFont="已取消";
                    break; 
                  case 4: //已支付
                    //如果要配送
                    if (ps) {
                        switch(tk){ // 已支付的退款状态
                        case '':
                          switch(deliver){
                          case 1:
                            payFont="未发货";
                            break;
                          case 2:
                            payFont="备货中";
                            break; 
                          case 3:
                            payFont="已发货";
                            break;     
                        }
                        break;
                      case 8:
                        payFont="退款中";
                        break;
                      case 9:
                        payFont="退款成功";
                          break;  
                      }
                    }else{
                      payFont="已完成";
                    }
                    
                    break;
                  case 5:
                      //如果要配送
                      if (ps) {
                          switch(tk){  // 已发货的退款状态
                          case '':
                          payFont="已发货";
                        break;
                        case 8:
                          payFont="退款中";
                          break;
                        case 9:
                          payFont="退款成功";
                            break;  
                        }
                     }else{
                      payFont="已完成";
                     };
                     break;
                      
                }

                var Data = {
                    payFont: payFont,
                    orderNum: orderNum,
                    mode:mode,
                    name:name,
                    phone:phone,
                    address:address

                }
                var orderSource = $("#order-template").html();
                var giveSource = $("#give-template").html();
                var orderTemplate = Handlebars.compile(orderSource);
                var giveTemplate = Handlebars.compile(giveSource);
                $(".order").append(orderTemplate(Data));
                $(".give").append(giveTemplate(Data));
                
                
                //商品详情
                var list=res.data.orderInfo;
                console.log(list);
                console.log(list.logisticsInfo);
                //发票
                if(list.logisticsInfo){
                  var source = $("#invoice-template").html();
                  var template = Handlebars.compile(source);
                  var invoiceContext = {
                    invoiceData: list.invoiceVO
                  }
                  if(invoiceContext.invoiceData.invoiceType==2){
                    invoiceContext.invoiceData.invoiceType='公司';
                    invoiceContext.invoiceData.companyFlag=true;
                  }else if(invoiceContext.invoiceData.invoiceType==1){
                    invoiceContext.invoiceData.invoiceType='个人';
                    invoiceContext.invoiceData.companyFlag=false;
                  }
                  
                  var html = template(invoiceContext);
                  $(".invoice").html(html);
                }else{
                  $(".invoice").hide();
                }
                //商品信息
                var detailSource = $("#detailInfo-template").html();
                var template = Handlebars.compile(detailSource);
                var detailContext = {
                    detailData: list.orderItemList[0],
                    imageUrl:res.data.imageUrl
                }
                  
                var detailHtml = template(detailContext);
                $(".detailInfo").html(detailHtml);
                $('.goodImg img').attr('src',detailContext.imageUrl+detailContext.detailData.mdseUrl);
                $("#body").show();
            }else{
                window.location.href="//www."+urlDomain+".com/not_found/index.shtml"
            }
            
          }else{
            // 未登录
            var backUrl=window.location;
            window.location.href="https://account."+urlDomain+".com/account/login.htm?backUrl=" + backUrl;
          }
        })
    var url=location.href;
	var domain='chexiang';
				if(url.indexOf('sit')!=-1){
					domain='chexiangsit';
				}else if(url.indexOf('chexiangpre')!=-1){
					domain='chexiangpre';
				}
    $('#index').on('click',function () {
    	location.href='//www.'+domain+'.com';
    })  
    $('#personal').on('click',function () {
    	location.href='//member.'+domain+'.com/member/member.htm';
    })
    $('#order').on('click',function () {
    	location.href='//member.'+domain+'.com/member/cxjOrder.htm';
    })
});
